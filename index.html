<!doctype html>
<html>
<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/Chart.js"></script>
    <script type="text/javascript" src="js/Sensors.js"></script>
    <script type="text/javascript" src="js/Environment.js"></script>
    <script type="text/javascript" src="js/Flyer.js"></script>
    <script type="text/javascript" src="js/KeyControls.js"></script>
    <script type="text/javascript" src="js/Renderer.js"></script>
    <script type="text/javascript" src="js/Simulation.js"></script>
    <link rel="stylesheet" href="css/index.css">

</head>
<body>
    <div id="main"></div>
    <div id="pane">
        <div class="heading">CONTROLLER</div>
        <div class="display">
            <a class="box selected" href="#">MANUAL</a>
            <a class="box" href="#">STABILIZE</a>
            <a class="box" href="#">AUTOPILOT</a>
        </div>
        <div class="heading">FLIGHT HISTORY</div>
        <div class="display">
            <a class="box selected" href="#">NONE</a>
            <a class="box" href="#">DOTS</a>
            <a class="box" href="#">PATH</a>
        </div>
        <div class="heading">SENSOR DATA</div>
        <div class="display">
            <div class="chart-title">Force</div>
            <div class="chart-container">
                <div class="chart">
                    &nbsp;
                </div>
            </div>
            <div class="chart-title">Angular Velocity</div>
            <div class="chart-container">
                <div class="chart">
                    &nbsp;
                </div>
            </div>
            <div class="chart-title">Linear Velocity</div>
            <div class="chart-container">
                <div class="chart">
                    &nbsp;
                </div>
            </div>
            <div class="chart-title">Angular Position</div>
            <div class="chart-container">
                <div class="chart">
                    &nbsp;
                </div>
            </div>
            <div class="chart-title">Linear Position</div>
            <div class="chart-container">
                <div class="chart">
                    &nbsp;
                </div>
            </div>
        </div>
    </div>
    <script>
        var env = new Environment();
        var flyer = new Flyer();
        var kc = new KeyControls();

        flyer.setController(kc);
        flyer.setPosition(0, 15);

        var sim = new Simulation(env);
        sim.addFlyer(flyer);

        // scale is in pixels per meter

        var renderer = new Renderer({
            sim: sim,
            view: $('#main'),
            scale: 30
        });

        // Set up charts
        var charts = {
            force: new Chart({
                view: $('#chart_force'),
                data: function () {
                    return [
                        flyer.sensor.left_engine,
                        flyer.sensor.right_engine
                    ];
                },
                max: 20,
                min: 0
            }),
            angular_velocity: new Chart({
                view: $('#chart_v_angular'),
                data: function () {
                    return [flyer.sensor.angular_velocity];
                },
                max: 2 * Math.PI,
                min: -2 * Math.PI
            }),
            linear_velocity: new Chart({
                view: $('#chart_v_angular'),
                data: function () {
                    return [
                        flyer.sensor.x_velocity,
                        flyer.sensor.y_velocity
                    ];
                },
                max: 30,
                min: -30
            }),
            angular_position: new Chart({
                view: $('#chart_pos_angular'),
                data: function () {
                    return [flyer.sensor.angular_position];
                },
                max: Math.PI,
                min: -1 * Math.PI
            })
        };

        // TBD: On simulation tick, update the charts
        sim.onTickComplete(function() {
            for (var key in charts) {
                charts[key].update();
            };
        });

        sim.start();
    </script>
</body>
</html>

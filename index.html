<!doctype html>
<html>
<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/Chart.js"></script>
    <script type="text/javascript" src="js/Sensors.js"></script>
    <script type="text/javascript" src="js/Environment.js"></script>
    <script type="text/javascript" src="js/Flyer.js"></script>
    <script type="text/javascript" src="js/KeyControls.js"></script>
    <script type="text/javascript" src="js/Renderer.js"></script>
    <script type="text/javascript" src="js/Simulation.js"></script>
    <link rel="stylesheet" href="css/index.css">

</head>
<body>
    <div id="main"></div>
    <div id="pane">
        <div class="heading">CONTROLLER</div>
        <div class="display">
            <a class="box selected" href="#">MANUAL</a>
            <a class="box" href="#">STABILIZE</a>
            <a class="box" href="#">AUTOPILOT</a>
        </div>
        <div class="heading">FLIGHT HISTORY</div>
        <div class="display">
            <a class="box selected" href="#">NONE</a>
            <a class="box" href="#">DOTS</a>
            <a class="box" href="#">PATH</a>
        </div>
        <div class="heading">SENSOR DATA</div>
        <div class="display">
            <div class="chart-title">Left Engine</div>
            <div class="chart-container">
                <div id="chart_left" class="chart"></div>
            </div>
            <div class="chart-title">Right Engine</div>
            <div class="chart-container">
                <div id="chart_right" class="chart"></div>
            </div>
            <div class="chart-title">Angular Velocity</div>
            <div class="chart-container">
                <div id="chart_v_angular" class="chart"></div>
            </div>
            <div class="chart-title">Vertical Velocity</div>
            <div class="chart-container">
                <div id="chart_v_y" class="chart"></div>
            </div>
            <div class="chart-title">Horizontal Velocity</div>
            <div class="chart-container">
                <div id="chart_v_x" class="chart"></div>
            </div>
            <div class="chart-title">Angular Position</div>
            <div class="chart-container">
                <div id="chart_pos_angular" class="chart"></div>
            </div>
        </div>
    </div>
    <script>
        var env = new Environment();
        var flyer = new Flyer();
        var kc = new KeyControls();

        flyer.setController(kc);
        flyer.setPosition(0, 15);

        var sim = new Simulation(env);
        sim.addFlyer(flyer);

        // scale is in pixels per meter

        var renderer = new Renderer({
            sim: sim,
            view: $('#main'),
            scale: 30
        });

        // Set up charts
        var charts = {
            left: new Chart({
                view: $('#chart_left'),
                data: function () {
                    return flyer.sensors.engines.left;
                },
                max: 20,
                min: 0,
                fill: true
            }),
            right: new Chart({
                view: $('#chart_right'),
                data: function () {
                    return flyer.sensors.engines.right;
                },
                max: 20,
                min: 0,
                fill: true
            }),
            angular_velocity: new Chart({
                view: $('#chart_v_angular'),
                data: function () {
                    return flyer.sensors.velocity.theta;
                },
                max: Math.PI / 2,
                min: -1 * Math.PI / 2,
                fill: true
            }),
            linear_velocity_y: new Chart({
                view: $('#chart_v_y'),
                data: function () {
                    return flyer.sensors.velocity.y;
                },
                max: 30,
                min: -30,
                fill: true
            }),
            linear_velocity_x: new Chart({
                view: $('#chart_v_x'),
                data: function () {
                    return flyer.sensors.velocity.x;
                },
                max: 30,
                min: -30,
                fill: true
            }),
            angular_position: new Chart({
                view: $('#chart_pos_angular'),
                data: function () {
                    return flyer.sensors.position.theta;
                },
                max: Math.PI,
                min: -1 * Math.PI
            })
        };

        // TBD: On simulation tick, update the charts
        sim.onTickComplete(function() {
            for (var key in charts) {
                charts[key].update();
            };
        });

        sim.onSimulationReset(function() {
            for (var key in charts) {
                charts[key].reset();
            };
        });

        sim.start();
    </script>
</body>
</html>
